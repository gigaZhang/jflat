<project name="jflat-test" default="test" basedir=".">

	<!-- Test Properties -->
	<property file="build-code.properties" />
	<property file="build-test.properties" />

	<import file="build-classpath.xml" />

	<target name="init">
		<mkdir dir="${test.classes}" />
		<mkdir dir="${junit.report.dir}" />
	</target>

	<target name="clean" description="Erases contents of classes dir">
		<delete dir="${test.classes}" />
		<delete dir="${junit.report.dir}" />
	</target>

	<!-- JUnit -->
	<target name="compile.tests" depends="init" description="Compiles all unit test source">
		<javac srcdir="${src.test}" destdir="${test.classes}" classpathref="junit.class.path" />
	</target>

	<target name="test" depends="compile.tests" description="Runs the unit tests">
		<junit forkMode="perBatch" printsummary="true" showoutput="false" fork="true" 
			failureproperty="tests-failed">
			<classpath>
				<path refid="junit.class.path" />
				<pathelement location="${build.classes}" />
				<pathelement location="${test.classes}" />
			</classpath>
			<formatter type="xml" usefile="true" />
			<batchtest todir="${junit.report.dir}">
				<fileset dir="${src.test}">
					<include name="**/*Test.java" />
				</fileset>
			</batchtest>
		</junit>
	</target>

	<target name="test.report" depends="test" description="generate HTML unit test reports">
		<junitreport todir="${junit.report.dir}">
			<fileset dir="${junit.report.dir}">
				<include name="TEST-*.xml" />
			</fileset>
			<report format="frames" todir="${junit.report.dir}" />
		</junitreport>
		<fail if="tests-failed" message="Unit test(s) failed."/>
	</target>

</project>